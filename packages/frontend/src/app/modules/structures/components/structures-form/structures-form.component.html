<div class="row">
  <div id="steps">
    <div
      class="step"
      *ngFor="let etape of etapes; let i = index"
      id="step{{ i }}">
      <div (click)="submitted = false">
        <span
          *ngIf="etapeInscription > i"
          class="step_number step_check">
          <fa-icon icon="check"></fa-icon>
        </span>
        <span
          *ngIf="etapeInscription <= i"
          [ngClass]="{
              step_active: etapeInscription == i,
               step_inactive: i > 0 && etapeInscription != i
            }"
          class="step_number">
          {{ i + 1 }}
        </span>
        <span
          [ngClass]="{
              step_text_active: etapeInscription == i,
              step_text_inactive: i > 0 && etapeInscription != i
            }"
          class="step_text">
          {{ etape }}
        </span>
      </div>
      <div
        *ngIf="i < 1"
        [className]="etapeInscription > i ? 'check_sep' : ''">
        <span
          class="separateur"
          [ngClass]="{ separateur_inactive: i > 0 }"></span>
      </div>
    </div>
  </div>
</div>

<div class="col-md-10 offset-md-1">
  <div class="w-100"></div>
  <ngb-alert
    @fadeInOut
    *ngIf="errorMessage"
    type="danger"
    (close)="errorMessage = null">
    <strong>Erreur:</strong>
    {{ errorMessage }}
  </ngb-alert>
  <ngb-alert
    @fadeInOut
    *ngIf="successMessage"
    type="success"
    (close)="successMessage = null">
    <strong>La structure a été créée avec succès</strong>
  </ngb-alert>
</div>
<div
  class="step_form"
  *ngIf="etapeInscription == 0">
  <div class="text-center">
    <h4 class="title">
      Vous créez un compte administrateur pour votre structure,
      <br>
      qui n’est pas encore référencée sur Domifa.
    </h4>
  </div>
  <form
    [formGroup]="structureForm"
    (ngSubmit)="submitStrucutre()"
    id="structureForm"
    autocomplete="off">
    <div class="row">
      <div class="col-md-12 text-center">Vous appartenez à…</div>
      <div class="col-md-12 text-center">
        <div
          class="btn"
          [ngClass]="{
              'btn-primary': f.structureType.value === 'ccas',
              'btn-outline-primary': f.structureType.value !== 'ccas',
              'btn-outline-danger': submitted && f.structureType.value === ''
            }">
          <input
            type="radio"
            id="ccas"
            class="d-none"
            value="ccas"
            formControlName="structureType">
          <label for="ccas">CCAS, CIAS, Commune</label>
        </div>
        <div
          class="btn"
          [ngClass]="{
              'btn-primary': f.structureType.value === 'asso',
              'btn-outline-primary': f.structureType.value !== 'asso',
              'btn-outline-danger': submitted && f.structureType.value === ''
            }">
          <input
            type="radio"
            id="asso"
            class="d-none"
            value="asso"
            formControlName="structureType">
          <label for="asso">Organisme agréée</label>
        </div>
      </div>

      <div
        *ngIf="submitted && f.structureType.value === ''"
        class="col-md-12 text-danger text-center">
        Veuillez sélectionner un des deux types d'organisme : CCAS ou organisme agréé
        <br>
      </div>

    </div>
    <br>

    <div class="text-center subtitle">
      Les coordonnées de cette structure, qui apparaîtront sur le Cerfa d’attestation, sont :
      <br>
    </div>
    <br>
    <div class="row">
      <div class="col-md-12 form-group required">
        <label for="nom">Raison sociale (nom de la structure)</label>
        <input
          type="text"
          class="form-control"
          id="nom"
          formControlName="nom"
          placeholder="Nom"
          [ngClass]="{ 'is-invalid': submitted && f.nom.errors }"
          required>
        <div
          *ngIf="submitted && f.nom.errors"
          class="invalid-feedback"
          autocomplete="null">
          <div *ngIf="f.nom.errors.required">
            Le
            <b>nom de la structure</b>
            est requis
          </div>
        </div>
      </div>

      <div class="col-md-12 form-group required">
        <label for="adresse">Adresse de l'organisme domiciliataire</label>
        <input
          id="adresse"
          type="text"
          class="form-control"
          formControlName="adresse"
          [ngClass]="{ 'is-invalid': submitted && f.adresse.errors }"
          autocomplete="null"
          placeholder="Cette adresse apparaîtra sur le Cerfa">
        <span *ngIf="searching">Recherche en cours...</span>
        <div
          class="invalid-feedback"
          *ngIf="searchFailed">
          Désolé, l'adresse recherchée n'existe pas
        </div>
        <div
          *ngIf="submitted && f.adresse.errors"
          class="invalid-feedback">
          <div *ngIf="f.adresse.errors.required">
            <b>L'adresse</b>
            est obligatoire
          </div>
        </div>
      </div>

      <div class="col-md-12 form-group">
        <label for="complementAdresse">Complément d'adresse</label>
        <input
          type="text"
          class="form-control"
          id="complementAdresse"
          autocomplete="null"
          formControlName="complementAdresse"
          placeholder="Lieu-dit, Bâtiment, étage, etc.."
          [ngClass]="{ 'is-invalid': submitted && f.complementAdresse.errors }">
        <div
          *ngIf="submitted && f.complementAdresse.errors"
          class="invalid-feedback">
          <b>L'adresse est obligatoire</b>
        </div>
      </div>
      <div class="col-md-6 form-group required">
        <label for="codePostal">Code postal</label>
        <input
          type="text"
          class="form-control"
          id="codePostal"
          autocomplete="null"
          maxlength="5"
          formControlName="codePostal"
          [ngClass]="{ 'is-invalid': submitted && f.codePostal.errors }">
        <div
          *ngIf="submitted && f.codePostal.errors"
          class="invalid-feedback">
          Le code postal est obligatoire
        </div>
      </div>
      <div class="col-md-6 form-group required">
        <label for="ville">Ville</label>
        <input
          type="text"
          class="form-control"
          id="ville"
          autocomplete="null"
          formControlName="ville"
          [ngClass]="{ 'is-invalid': submitted && f.ville.errors }">
        <div
          *ngIf="submitted && f.ville.errors"
          class="invalid-feedback">
          La ville est obligatoire
        </div>
      </div>

      <div class="col-md-12">
        <div class="form-check form-group">
          <input
            class="form-check-input"
            type="checkbox"
            formControlName="adresseDifferente"
            value="true"
            id="adresseDifferente">
          <label
            class="form-check-label"
            for="adresseDifferente">
            L'adresse de réception du courrier est différente de celle de l'association ?
          </label>
        </div>
      </div>
    </div>
    <div
      class="row"
      *ngIf="f.adresseDifferente.value === true">
      <div class="col-md-12 form-group">
        <label for="adresseCourrier">Adresse de réception du courrier</label>
        <input
          type="text"
          class="form-control"
          id="adresseCourrier"
          autocomplete="null"
          formControlName="adresseCourrier"
          placeholder="15 rue des bois, etc.."
          [ngClass]="{ 'is-invalid': submitted && f.adresseCourrier.errors }">
      </div>
    </div>

    <div class="row">
      <div class="col form-group required">
        <label for="phone">Numéro de téléphone</label>
        <input
          type="tel"
          class="form-control"
          id="phone"
          digitOnly
          formControlName="phone"
          placeholder="0606060606"
          autocomplete="null"
          maxlength="10"
          [ngClass]="{ 'is-invalid': submitted && f.phone.errors }"
          required>
        <div
          *ngIf="submitted && f.phone.errors"
          class="invalid-feedback">
          <div
            *ngIf="submitted && f.phone.errors"
            class="invalid-feedback">
            <div>Le numéro de téléphone est incorrect</div>
          </div>
          <small
            id="phoneHelp"
            class="form-text text-muted">
            Optionnel
          </small>
        </div>
      </div>
      <div class="col form-group required">
        <label for="email">Adresse e-mail indiquée sur le Cerfa</label>
        <input
          type="email"
          class="form-control"
          id="email"
          formControlName="email"
          placeholder="Email"
          autocomplete="null"
          [ngClass]="{ 'is-invalid': submitted && f.email.errors }"
          required>
        <div
          *ngIf="submitted && f.email.errors"
          class="invalid-feedback">
          Veuillez vérifier l'adresse email
        </div>
      </div>
    </div>
    <br>
    <div
      class="row"
      *ngIf="f.structureType.value === 'asso'">

      <div class="col-md-12 text-center ">
        <h5 class="subtitle">
          Quelles sont ses informations d’agrément ?
        </h5>
      </div>

      <div class="col form-group required">
        <label for="departementAuto">Préfecture ayant délivré l’agrément</label>
        <input
          id="departementAuto"
          type="text"
          class="form-control"
          formControlName="departementAuto"
          [ngbTypeahead]="searchDepartement"
          (selectItem)="selectDepartement($event)"
          [resultTemplate]="rtDepartement"
          [inputFormatter]="formatDepartement">
        <div
          *ngIf="submitted && f.departement.errors"
          class="invalid-feedback">
          Veuillez sélectionner un département
        </div>
        <input
          type="hidden"
          formControlName="departement"
          id="departement"
          class="form-control"
          value
          required>

        <ng-template
          #rtDepartement
          let-r="result"
          let-t="term">
          <ngb-highlight
            [result]="formatDepartement(r)"
            [term]="t">
          </ngb-highlight>
        </ng-template>
      </div>

      <div class="col form-group required">
        <label for>Numéro d'agrément</label>
        <input
          formControlName="agrement"
          class="form-control"
          id="agrement"
          placeholder="Numéro donné par la préfecture"
          type="text"
          [ngClass]="{ 'is-invalid': submitted && f.agrement.errors }"
          required>
        <div
          *ngIf="submitted && f.agrement.errors"
          class="invalid-feedback">
          Veuillez insérer un numéro d'agrément
        </div>
      </div>

    </div>
    <br>
    <div class="col-md-12  text-center">
      <h5 class="subtitle">Qui est son responsable légal ?</h5>
      Il s’agit du nom qui apparaîtra sur le Cerfa.
    </div>
    <br>
    <div
      class="row"
      formGroupName="responsable">
      <div class="col-md-6 form-group required">
        <label for="responsable-nom">Nom</label>
        <input
          type="text"
          class="form-control"
          id="responsable-nom"
          formControlName="nom"
          placeholder="Nom d'un.e responsable"
          [ngClass]="{ 'is-invalid': submitted && f.responsable.get('nom').errors }"
          required>
        <div
          *ngIf="submitted && f.responsable.get('nom').errors"
          class="invalid-feedback">
          <div *ngIf="f.responsable.get('nom').errors.required">
            Le
            <b>nom</b>
            du demandeur est obligatoire
          </div>
        </div>
      </div>
      <div class="col-md-6  form-group required">
        <label for="responsable-prenom">Prénom(s)</label>
        <input
          type="text"
          class="form-control"
          id="responsable-prenom"
          formControlName="prenom"
          placeholder="Prénom(s)"
          [ngClass]="{ 'is-invalid': submitted && f.responsable.get('prenom').errors }"
          required>
        <div
          *ngIf="submitted && f.responsable.get('prenom').errors"
          class="invalid-feedback">
          <div *ngIf="f.responsable.get('prenom').errors.required">
            Le
            <b>Prénom</b>
            est obligatoire
          </div>
        </div>

      </div>
      <div class="col-md-12 form-group required">
        <label for="fonction">Fonction</label>
        <input
          type="text"
          class="form-control"
          id="fonction"
          formControlName="fonction"
          placeholder="Président.e, Directrice, etc."
          [ngClass]="{ 'is-invalid': submitted && f.responsable.get('fonction').errors }"
          required>
        <div
          *ngIf="submitted && f.responsable.get('fonction').errors"
          class="invalid-feedback">
          <div *ngIf="f.responsable.get('fonction').errors.required">Votre fonction est obligatoire</div>
        </div>
      </div>

    </div>
    <div class="row">
      <div class="col-md-12 text-center">
        <br>
        <button class="btn btn-primary">Enregistrer votre structure</button>
        <br>
      </div>
      <br>
    </div>
  </form>
</div>

<div *ngIf="structureInscription.etapeInscription == 1">
  <app-register-user [structureChild]="structureInscription"></app-register-user>
</div>
