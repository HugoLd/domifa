<div class="col-md-10 offset-md-1">
  <div class="w-100"></div>
  <ngb-alert
    @fadeInOut
    *ngIf="errorMessage"
    type="danger"
    (close)="errorMessage = null">
    <strong>Erreur:</strong>
    {{ errorMessage }}
  </ngb-alert>
  <ngb-alert
    @fadeInOut
    *ngIf="successMessage"
    type="success"
    (close)="successMessage = null">
    <strong>{{ successMessage }}</strong>
  </ngb-alert>
</div>

<div class="step_form">
  <div class="text-center">
    <h5 class="title">
      Vous créez un compte administrateur pour votre structure,
      <br>
      qui n’est pas encore référencée sur Domifa.
    </h5>
  </div>
  <br>
  <br>
  <form
    [formGroup]="structureForm"
    (ngSubmit)="submitUser()"
    autocomplete="off">
    <div class="row">
      <div class="col-md-12 text-center">
        <div
          class="btn-group btn-group-toggle"
          data-toggle="buttons">
          <label class="btn btn-primary active">
            <input
              type="radio"
              formControlName="structureType"
              id="asso">
            Un CCAS, un CIAS ou une commune
          </label>
          <label class="btn btn-primary">
            <input
              type="radio"
              formControlName="structureType"
              id="ccas">
            Un organisme agréé
          </label>
        </div>
      </div>
    </div>
    <br>
    <br>
    <div class="row">
      <div class="col-md-12 form-group required">
        <label for="nom">Raison sociale (nom de la structure)</label>
        <input
          type="text"
          class="form-control"
          id="nom"
          formControlName="nom"
          placeholder="Nom"
          [ngClass]="{ 'is-invalid': submitted && f.nom.errors }"
          required>
        <div
          *ngIf="submitted && f.nom.errors"
          class="invalid-feedback"
          autocomplete="null">
          <div *ngIf="f.nom.errors.required">
            Le
            <b>nom de la structure</b>
            est requis
          </div>
        </div>
      </div>

      <div class="col-md-12 form-group required">
        <label for="adresseAuto">Adresse</label>
        <input
          type="text"
          class="form-control"
          id="adresseAuto"
          formControlName="adresseAuto"
          placeholder="15 rue des bois, etc.."
          [ngClass]="{ 'is-invalid': submitted && f.prenom.errors }"
          required>
        <div
          *ngIf="submitted && f.adresseAuto.errors"
          class="invalid-feedback"
          autocomplete="null">
          <div *ngIf="f.adresseAuto.errors.required">
            <b>L'adresse</b>
            est obligatoire
          </div>
        </div>
      </div>

      <div class="col-md-12 form-group required">
        <label for="complementAdresse">Complément d'adresse</label>
        <input
          type="text"
          class="form-control"
          id="complementAdresse"
          formControlName="complementAdresse"
          placeholder="15 rue des bois, etc.."
          [ngClass]="{ 'is-invalid': submitted && f.prenom.errors }"
          required>
        <div
          *ngIf="submitted && f.complementAdresse.errors"
          class="invalid-feedback"
          autocomplete="null">
          <div ngIf="f.complementAdresse.errors.required">
            <b>L'adresse</b>
            est obligatoire
          </div>
        </div>
      </div>

      <div class="col-md-12">
        <div class="form-check form-group">
          <input
            class="form-check-input"
            type="checkbox"
            value
            id="defaultCheck1">
          <label
            class="form-check-label"
            for="defaultCheck1">
            L'adresse de réception du courrier est différente de celle de l'association ?
          </label>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col form-group required">
        <label for="phone">Numéro de téléphone</label>
        <input
          type="tel"
          class="form-control"
          id="phone"
          formControlName="phone"
          placeholder="0606060606"
          [ngClass]="{ 'is-invalid': submitted && f.phone.errors }"
          required>
        <div
          *ngIf="submitted && f.phone.errors"
          class="invalid-feedback"
          autocomplete="null">
          <div
            *ngIf="submitted && f.phone.errors"
            class="invalid-feedback">
            <div>Le numéro de téléphone est incorrect</div>
          </div>
          <small
            id="phoneHelp"
            class="form-text text-muted">
            Optionnel
          </small>
        </div>
      </div>
      <div class="col form-group required">
        <label for="email">Adresse e-mail indiquée sur le Cerfa</label>
        <input
          type="email"
          class="form-control"
          id="email"
          formControlName="email"
          placeholder="Email"
          [ngClass]="{ 'is-invalid': submitted && f.email.errors }"
          required>
        <div
          *ngIf="submitted && f.email.errors"
          class="invalid-feedback"
          autocomplete="null">
          <div *ngIf="f.email.errors.required">
            L'adresse
            <b>Email</b>
            est obligatoire
          </div>
        </div>
      </div>
    </div>
    <br>
    <div class="row">
      <h5 class="text-center title">
        Quelles sont ses informations d’agrément ?
      </h5>
    </div>
    <br>
    <br>
    <div>
      <div class="col form-group">
        <label for="departement">Préfecture ayant délivré l’agrément</label>
        <input
          id="typeahead-template"
          type="text"
          class="form-control"
          formControlName="departementSearch"
          [ngbTypeahead]="search"
          [inputFormatter]="formatter">
      </div>
      <div class="col form-group required">
        <label for="nom">Numéro d'agrément</label>
        <input
          type="text"
          class="form-control"
          id="agrement"
          formControlName="agrement"
          placeholder="Numéro donné par la préfecture"
          [ngClass]="{ 'is-invalid': submitted && f.agrement.errors }"
          required>

      </div>
    </div>
    <br>
    <br>
    <div class="text-center">
      <h5 class="title">Qui est son responsable légal ?</h5>
      Il s’agit du nom qui apparaîtra sur le Cerfa.
    </div>
    <br>
    <div
      class="row"
      [formGroupName]="responsable">
      <div class="col form-group required">
        <label for="nom">Nom</label>
        <input
          type="text"
          class="form-control"
          id="nom"
          formControlName="nom"
          placeholder="Nom d'un.e responsable"
          [ngClass]="{ 'is-invalid': submitted && f.responsable.nom.errors }"
          required>
        <div
          *ngIf="submitted && f.responsable.nom.errors"
          class="invalid-feedback"
          autocomplete="null">
          <div *ngIf="f.responsable.nom.errors.required">
            Le
            <b>nom</b>
            du demandeur est obligatoire
          </div>
        </div>
      </div>
      <div class="col form-group required">
        <label for="prenom">Prénom(s)</label>
        <input
          type="text"
          class="form-control"
          id="prenom"
          formControlName="prenom"
          placeholder="Prénom(s)"
          [ngClass]="{ 'is-invalid': submitted && f.prenom.errors }"
          required>
        <div
          *ngIf="submitted && f.responsable.prenom.errors"
          class="invalid-feedback"
          autocomplete="null">
          <div *ngIf="f.responsable.prenom.errors.required">
            Le
            <b>Prénom</b>
            est obligatoire
          </div>
        </div>
      </div>
      <div class="col form-group required">
        <label for="fonction">Fonction</label>
        <input
          type="text"
          class="form-control"
          id="fonction"
          formControlName="fonction"
          placeholder="Président.e, Directrice, etc."
          [ngClass]="{ 'is-invalid': submitted && f.fonction.errors }"
          required>
        <div
          *ngIf="submitted && f.responsable.fonction.errors"
          class="invalid-feedback"
          autocomplete="null">
          <div *ngIf="f.responsable.fonction.errors.required">Votre fonction est obligatoire</div>
        </div>
      </div>
    </div>
    <div class="row">
      <input
        type="hidden"
        formControlName="adressePostale"
        id="input"
        class="form-control"
        value>
      <input
        type="hidden"
        formControlName="codePostal"
        id="input"
        class="form-control"
        value>
      <input
        type="hidden"
        formControlName="ville"
        id="input"
        class="form-control"
        value>
      <input
        type="hidden"
        formControlName="departement"
        id="input"
        class="form-control"
        value>
      <br>
      <div class="text-center">
        <button class="btn btn-primary">Finaliser mon inscription</button>
        <br>
        <br>
        <br>
        <a
          href
          class="btn btn-outline-dark">
          Retour en arrière
        </a>
      </div>
    </div>
  </form>
</div>

<ng-template
  #rt
  let-r="result"
  let-t="term">
  <ngb-highlight
    [result]="r.name"
    [term]="t"></ngb-highlight>
</ng-template>
