<div class="container" id="manage">
  <h4 class="text-center"><b>Bonjour Domifa</b></h4>
  <div class="row">
    <div class="col-md-6 offset-md-3 ">
      <div class="form-group">
        <div id="searchbar">
          <span id="search_icon">
            <fa-icon icon="search"></fa-icon>
          </span>
          <input type="text" [(ngModel)]="searchWord" #searchInput placeholder="Recherche par nom, prénom ou numéro de domicilié" class="form-control">
          <span *ngIf="searchInput.value !== ''" (click)="resetSearchBar()" id="times_icon">
            <fa-icon icon="times-circle"></fa-icon>
          </span>
        </div>
      </div>
    </div>
  </div>
  <div id="filters">
    <div class="row">
      <span> Statut : </span>
      <button class="btn" [ngClass]="(filters.statut === 'valide') ?  'btn-primary': 'btn-outline-dark'" (click)="updateFilters('statut', 'valide')">
        Actif
      </button>
      <button class="btn " [ngClass]="(filters.statut === 'instruction') ?  'btn-warning': 'btn-outline-dark'" (click)="updateFilters('statut', 'instruction')">
        À compléter
      </button>
      <button class="btn" [ngClass]="(filters.statut === 'demande') ?  'btn-warning': 'btn-outline-dark'" (click)="updateFilters('statut', 'demande')">
        En attente de décision
      </button>
      <button class="btn" [ngClass]="(filters.statut === 'refus') ?  'btn-danger': 'btn-outline-dark'" (click)="updateFilters('statut', 'refus')">
        Refusé
      </button>
      <button class="btn" [ngClass]="(filters.statut === 'radie') ?  'btn-danger': 'btn-outline-dark'" (click)="updateFilters('statut', 'radie')">
        Radié
      </button>
    </div>
    <div class="row">
      <span> Échéance : </span>
      <button class="btn" [ngClass]="(filters.statut === 'radiation') ?  'btn-dark': 'btn-outline-dark'" (click)="updateFilters('statut', 'avenir')">
        Radiation possible
      </button>
      <button class="btn" [ngClass]="(filters.statut === 'avenir') ?  'btn-dark': 'btn-outline-dark'" (click)="updateFilters('echeance', 'deuxmois')">
        Renouvellement à venir
      </button>
    </div>
    <div class="row">
      <span> Courrier : </span>
      <button class="btn" [ngClass]="(filters.interactionType === 'courrierIn') ?  'btn-dark': 'btn-outline-dark'" (click)="updateFilters('interactionType', 'courrierIn')">
        Courrier à récupérer
      </button>
    </div>
  </div>
  <br> <br>

  <ngb-alert *ngIf="usagers.length === 0" [dismissible]='false' type="warning">
    <div class="text-center">
      <strong>Aucun résultat</strong> :
      aucun dossier ne correspond à votre recherche
      &nbsp;&nbsp;&nbsp;
      <button (click)="resetFilters()" class="btn btn-outline-white">Réinitialiser les filtres</button>
    </div>
  </ngb-alert>

  <div class="row">
    <table class="table">
      <tbody>
        <tr *ngFor="let usager of usagers;">
          <td (click)="goToProfil(usager.id, usager.decision.statut)"  isComplete="'dhii'" scope="row" class="table_name">
            <b>{{ usager.sexe === "femme" ? 'Mme' : 'M.' }} {{ usager.nom }} {{ usager.prenom }}</b> ({{ usager.id}})
          </td>
          <td (click)="goToProfil(usager.id, usager.decision.statut)">
            <span *ngIf="usager.rdv">
              {{ usager.dateNaissance | date:'dd/MM/yyyy' }}
            </span>
          </td>
          <td class="text-right icones_liste" *ngIf="usager.decision.statut === 'valide'">
            <div>
              <span ngbTooltip="Ajouter un nouveau courrier">
                <fa-icon class="courrier" icon="envelope"></fa-icon>
              </span>
              <span *ngIf="usager.lastInteraction.nbCourrier > 0" ngbTooltip="Signaler un retrait de courrier">
                <fa-icon class="courrier" icon="envelope-open-text"></fa-icon>
                <b class="notification">{{ usager.lastInteraction.nbCourrier }}</b>
              </span>
              <span ngbTooltip="Signaler un passage">
                <fa-icon class="visite" icon="walking"></fa-icon>
              </span>
              <span ngbTooltip="Signaler un appel">
                <fa-icon class="appel" icon="phone"></fa-icon>
              </span>
            </div>
          </td>
          <td (click)="goToProfil(usager.id, usager.decision.statut)" *ngIf=" usager.decision.statut !=='valide'">
          </td>
          <td (click)="goToProfil(usager.id, usager.decision.statut)" class="text-right">
            <span class="active" *ngIf="usager.decision.statut !== 'demande' && usager.decision.statut !== 'instruction'">
              Accéder à sa fiche
            </span>
            <span class="active" *ngIf="usager.decision.statut === 'demande'">
              <fa-icon [icon]="['fas', 'hourglass-half']"></fa-icon>&nbsp;
              Afficher la demande
            </span>
            <span class="active" *ngIf="usager.decision.statut === 'instruction'">
              <fa-icon [icon]="['far', 'clock']"></fa-icon>&nbsp;
              Reprendre la demande
            </span>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
