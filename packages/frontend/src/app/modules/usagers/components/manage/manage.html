<div class="container" id="manage">
  <h4 class="text-center"><b>Bonjour Domifa</b></h4>
  <div class="row">
    <div class="col-md-6 offset-md-3 ">
      <div class="form-group">
        <div id="searchbar">
          <span id="search_icon">
            <fa-icon icon="search"></fa-icon>
          </span>
          <input type="text" [(ngModel)]="searchWord" #searchInput placeholder="Rechercher un.e domicilié par nom, prénom, numéro de domicilié" class="form-control">
          <span *ngIf="searchInput.value !== ''" (click)="resetSearchBar()" id="times_icon">
            <fa-icon icon="times-circle"></fa-icon>
          </span>
        </div>
        <span *ngIf="searching">Recherche en cours...</span>
        <div class="invalid-feedback" *ngIf="searchFailed">
        </div>
        <div class="row" *ngIf="searching">
          <div class="col-12 text-center">
            <h4>Recherche en cours ... </h4>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div id="filters">
    <div class="row">
      <span> Statut : </span>
      <button class="btn " [ngClass]="(filters.statut === 'instruction') ?  'btn-dark': 'btn-outline-dark'" (click)="updateFilters('statut', 'instruction')">
        Demande en cours
      </button>
      <button class="btn" [ngClass]="(filters.statut === 'demande') ?  'btn-dark': 'btn-outline-dark'" [ngClass]="(filters.statut === 'demande') ?  'btn-dark': 'btn-outline-dark'"
        (click)="updateFilters('statut', 'demande')">
        À valider
      </button>
      <button class="btn" [ngClass]="(filters.statut === 'refus') ?  'btn-dark': 'btn-outline-dark'" (click)="updateFilters('statut', 'refus')">
        Refusé
      </button>
      <button class="btn" [ngClass]="(filters.statut === 'radie') ?  'btn-dark': 'btn-outline-dark'" (click)="updateFilters('statut', 'radie')">
        Radié
      </button>
      <button class="btn" [ngClass]="(filters.statut === 'valide') ?  'btn-dark': 'btn-outline-dark'" (click)="updateFilters('statut', 'valide')">
        Actif
      </button>
    </div>
    <div class="row">
      <span> Échéance : </span>
      <button class="btn" [ngClass]="(filters.statut === 'avenir') ?  'btn-dark': 'btn-outline-dark'" (click)="updateFilters('statut', 'avenir')">
        Aucun signe de vie
      </button>
      <button class="btn btn-outline-dark" [ngClass]="{'filters.statut': filters.statut === null }" (click)="updateFilters('echeance', 'deuxmois')">
        Renouvellement à venir
      </button>
    </div>
    <div class="row">
      <span> Courrier : </span>
      <button class="btn btn-outline-dark" [ngClass]="{'filters.statut': filters.statut === null }" (click)="updateFilters('courrier', true)">
        Courrier à récupérer
      </button>
      <button class="btn btn-outline-dark" [ngClass]="{'filters.statut': filters.statut === null }" (click)="updateFilters('courrier', false)">
        Pas de courrier
      </button>
    </div>
  </div>
  <br> <br>

  <ngb-alert *ngIf="usagers.length === 0" [dismissible]='false' type="warning">
    <div class="text-center">
      <strong>Aucun résultat</strong> :
      aucun dossier ne correspond à votre Recherche
      &nbsp;&nbsp;&nbsp;
      <button (click)="resetFilters()" class="btn btn-outline-white">Réinitialiser les filtres</button>
    </div>
  </ngb-alert>

  <div class="row">
    <table class="table">
      <tbody>
        <tr *ngFor="let usager of usagers">
          <td [routerLink]="['/profil', usager.id]" scope="row" class="table_name" [class]='usager.decision.statut'>
            <b>{{ usager.sexe === "femme" ? 'Mme' : 'M.' }} {{ usager.nom }} {{ usager.prenom }}</b> ({{ usager.id}})
          </td>
          <td [routerLink]="['/profil', usager.id]">
            <span *ngIf="usager.rdv">
              {{ usager.dateNaissance | date:'dd/MM/yyyy' }}
            </span>
          </td>
          <td class="text-right icones_liste">
            <div *ngIf="usager.decision.statut === 'valide'">
              <span>
                <fa-icon id="courrier" icon="envelope"></fa-icon>
              </span>
              <span>
                <fa-icon id="visite" icon="walking"></fa-icon>
              </span>
              <span>
                <fa-icon id="appel" icon="phone"></fa-icon>
              </span>
            </div>
          </td>
          <td [routerLink]="['/profil', usager.id]" class="text-right">
            <a [routerLink]="['/profil', usager.id]" routerLinkActive="router-link-active" *ngIf="usager.decision.statut !== 'instruction'">
              Accéder à sa fiche
            </a>
            <a *ngIf="usager.decision.statut === 'instruction'" [routerLink]="['/profil', usager.id, 'edit']" routerLinkActive="router-link-active">
              <fa-icon icon="clock"></fa-icon> Reprendre la demande
            </a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
