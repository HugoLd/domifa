<div class="step_form text-center">
  <div class="row">
    <div class="col-md-12">
      <h4 class="text-center">
        <b>Importer vos domiciliés</b>
      </h4>
      <p>
        Avant de commencer à utiliser Domifa, nous vous invitons à importer le listing de vos domiciliés.
        <br>
        À l'aide du document explicatif, vous devrez remplir le tableau Excel fourni par Domifa.
        <br>
      </p>
    </div>
    <div
      id="import-menu"
      class="col-md-10 offset-1">
      <a
        href="/assets/files/modele.xlsx"
        target="_blank"
        class="btn btn-outline-primary"
        download>
        <b>Etape 1 :</b>
        Téléchargez  le modèle Excel
      </a>
      <a
        href="/assets/files/tuto-import.pdf"
        target="_blank"
        class="btn btn-outline-primary"
        download>
        <b>Etape 2 :</b>
        Téléchargez et lisez la FAQ
        <fa-icon icon="question-circle"></fa-icon>
      </a>

      <form
        [formGroup]="uploadForm"
        (ngSubmit)="submitFile()">
        <div>
          <label
            class="btn btn-outline-primary"
            for="fileExcel"
            data-browse="Parcourir"
            lang="fr">
            <b>Etape 3 :</b>
            Sélectionner et vérifier le fichier
          </label>
          <input
            type="file"
            id="fileExcel"
            name="fileExcel"
            (change)="onFileChange($event)"
            multiple="false"
            file="fileExcel"
            required>
          <input
            type="hidden"
            name="fileHidden"
            formControlName="fileInput">
        </div>
        <div
          class="form-group"
          *ngIf="!uploadForm.invalid && errorsId.length == 0">
          <br>
          <button
            type="submit"
            class="btn btn-secondary">
            <b>Etape 4 :</b>
            Importer vos domiciliés sur Domifa
          </button>
          <br>
          <div class="text-secondary">
            <fa-icon icon="check-circle"></fa-icon>
            Votre fichier est prêt à être importé
          </div>
        </div>
      </form>

      <button
        *ngIf="errorsId.length > 0"
        (click)="reload()"
        class="btn btn-danger">
        Recommencer
      </button>

      <div
        *ngIf="errorsId.length > 0"
        class="text-danger">
        <p>
          Attention : votre fichier contient
          <b>{{ errorsId.length }}</b>
          erreurs
        </p>
        <p *ngIf="emailErrors > 0">
          Doublons :
          <b>
            {{ emailErrors+1 }} emails sont identiques
          </b>
        </p>
        <p *ngIf="phoneErrors > 0">
          <b>
            {{ phoneErrors+1 }} numéros de Téléphone sont identiques
          </b>
        </p>
        <p>
          Les champs incorrects sont marqués en rouge dans le tableau ci-dessous
        </p>
      </div>
    </div>
  </div>
</div>
<div
  id="import-table"
  *ngIf="!uploadForm.invalid">
  <table class="table table-striped table-hover">
    <thead class>
      <th>#</th>
      <th class="required">Civilité (H/F)</th>
      <th class="required">Nom</th>
      <th class="required">Prénom</th>
      <th>Surnom</th>
      <th class="required">
        Date Naissance
        <br>
        (jj/mm/aaaa)
      </th>
      <th class="required">Lieu naissance</th>
      <th>Adresse Mail</th>
      <th>N° Téléphone</th>
      <th class="required">Type demande</th>
      <th class="required">Statut demande</th>
      <th class="required">
        Date de Début
        <br>
        de la DOM actuelle
      </th>
      <th>Fin de DOM</th>
      <th>
        Date de la 1
        <sup>ère</sup>
        DOM
      </th>
      <th>
        MOTIF REFUS
        <br>
        (SEULEMENT SI REFUS)
      </th>
      <th>
        MOTIF RADIATION
        <br>
        (SEULEMENT SI RADIATION)
      </th>
      <th>COMPOSITION DU MÉNAGE</th>
      <ng-container *ngFor="let ayantDroit of nbreAyantsDroits; let indexRow = index">
        <th>
          NOM
          <br>
          Ayant-droit {{ indexRow + 1}}
        </th>
        <th>
          PRÉNOM
          <br>
          Ayant-droit {{ indexRow + 1}}
        </th>
        <th>
          DATE NAISSANCE
          <br>
          Ayant-droit {{ indexRow + 1}}
        </th>
        <th>
          LIEN DE PARENTÉ
          <br>
          Ayant-droit {{ indexRow + 1}}
        </th>
      </ng-container>
    </thead>
    <tbody *ngIf="showTable">
      <tr *ngFor="let row of data | slice:1; let index = index;">
        <td>
          <b>{{ index + 1 }}</b>
        </td>
        <td [ngClass]="{ 'table-danger': isAnError(index, 0)  }">{{row[0]}}</td>
        <td [ngClass]="{ 'table-danger': isAnError(index, 1)  }">{{ row[1] }}</td>
        <td [ngClass]="{ 'table-danger': isAnError(index, 2)  }">{{ row[2] }}</td>
        <td>{{row[3]}}</td>
        <td [ngClass]="{ 'table-danger': isAnError(index, 4)  }">{{ row[4] }}</td>
        <td [ngClass]="{ 'table-danger': isAnError(index, 5)  }">{{ row[5] }}</td>
        <td [ngClass]="{ 'table-danger': isAnError(index, 6)  }">{{ row[6] }}</td>
        <td [ngClass]="{ 'table-danger': isAnError(index, 7)  }">{{ row[7] }}</td>
        <td [ngClass]="{ 'table-danger': isAnError(index, 9)  }">{{ row[9] }}</td>
        <td [ngClass]="{ 'table-danger': isAnError(index, 8)  }">{{ row[8] }}</td>
        <td [ngClass]="{ 'table-danger': isAnError(index, 10) }">{{ row[10] }}</td>
        <td [ngClass]="{ 'table-danger': isAnError(index, 11) }">{{ row[11] }}</td>
        <td [ngClass]="{ 'table-danger': isAnError(index, 12) }">{{ row[12] }}</td>
        <td [ngClass]="{ 'table-danger': isAnError(index, 13) }">{{ row[13] }}</td>
        <td [ngClass]="{ 'table-danger': isAnError(index, 14) }">{{ row[14] }}</td>
        <td [ngClass]="{ 'table-danger': isAnError(index, 15) }">{{ row[15] }}</td>
        <ng-container *ngFor="let ayantDroit of nbreAyantsDroits; let indexRow = index">
          <td [ngClass]="{ 'table-danger': isAnError(index, ayantDroit ) }">{{ row[ayantDroit] }}</td>
          <td [ngClass]="{ 'table-danger': isAnError(index, ayantDroit + 1 ) }">{{ row[ayantDroit + 1] }}</td>
          <td [ngClass]="{ 'table-danger': isAnError(index, ayantDroit + 2 ) }">{{ row[ayantDroit + 2] }}</td>
          <td [ngClass]="{ 'table-danger': isAnError(index, ayantDroit + 3 ) }">{{ row[ayantDroit + 3] }}</td>
        </ng-container>
      </tr>
    </tbody>
  </table>
</div>
